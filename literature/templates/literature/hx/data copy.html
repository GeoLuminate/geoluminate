{% load static sekizai_tags %}

<div class='inner container'>
  <section class='d-flex h-100 w-100 overflow-hidden'>
    <div class='flex-grow-1 h-100 overflow-auto'>
      <section class='pt-0'>
        <div id="tabbedContent" class="tab-content container-fluid pt-3">
          <div id="{{table.label|slugify}}-container" class='tab-pane fade'>
            <div class='table-responsive'>
              <table id="{{table.label|slugify}}-table" 
                class="table table-hover w-100"
                data-ajax="{{table.get_url}}?format=datatables&{{filter_by}}"
                data-web-url="{{table.Meta.web_url}}"
                >
                <thead>
                <tr>
                {% for cell in table.header %}
                  <th data-data='{{cell.0}}' class='px-2'><span {% if cell.2 %}data-placement="bottom" data-trigger="hover" data-html="true" data-content="{{cell.2|safe}}"{% endif %} style='white-space: nowrap;'>{{cell.1|capfirst}}</th>
                {% endfor %}
                </tr></thead>
              </table>
            </div>
          </div>
          </div>
      </section> 
    </div>
  </section>
</div>

        
{% addtoblock "css" %}<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.21/r-2.2.5/datatables.min.css"/>{% endaddtoblock %}
{% addtoblock "css" %}<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.0.0/css/buttons.dataTables.min.css"/>{% endaddtoblock %}
{% addtoblock "css" %}<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css"/>{% endaddtoblock %}
{% addtoblock "css" %}<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/keytable/2.6.4/css/keyTable.dataTables.min.css"/>{% endaddtoblock %}
{% addtoblock "css" %}<link rel="stylesheet" type="text/css" href="{% static 'data_editor/css/editor.dataTables.css' %}"/>{% endaddtoblock %}
{% addtoblock "css" %}<link rel="stylesheet" type="text/css" href="{% static 'data_editor/css/editor.dataTables.css' %}"/>{% endaddtoblock %}


{% addtoblock "js" %}<script>$(function(){$('[data-trigger="hover"]').popover()})</script>{% endaddtoblock %}

{% comment %} Datatables and Editor.js {% endcomment %}
{% addtoblock "js" %}<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.21/r-2.2.5/datatables.min.js"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static 'data_editor/js/dataTables.editor.min.js' %}"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static 'geoluminate/js/table.js' %}"></script>{% endaddtoblock %}

{% comment %} Excel like navigation {% endcomment %}
{% addtoblock "js" %}<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.0.0/js/dataTables.buttons.min.js"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script type="text/javascript" src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script type="text/javascript" src="https://cdn.datatables.net/keytable/2.6.4/js/dataTables.keyTable.min.js"></script>{% endaddtoblock %}

{% comment %} Table Creation {% endcomment %}
{% addtoblock "js" %}

<script>
$('#{{table.label|slugify}}-tab').on('shown.bs.tab', function(e) {
  if ( ! $.fn.DataTable.isDataTable( '#{{table.label|slugify}}-table') ) {
    $('#{{table.label|slugify}}-table').create_table()
  }
})
</script>


{% endaddtoblock %}

{% comment %} {% with id=table.label|slugify editor=table.editor %}
{% addtoblock "js" %}
<script>
  $(document).ready(function () {
      var {{editor}} = new $.fn.dataTable.Editor({
          ajax: "{{table.url}}editor/?format=datatables&{{filter_by}}",   
          table: '#{{id}}-table',
          idSrc: 'id',
          fields: [ {
                    label: "Site name:",
                    name: "site.site_name"
                }, {
                    label: "Lat:",
                    name: "site.lat"
                }, {
                    label: "Lon:",
                    name: "site.lng"
                }, {
                    label: "Depth:",
                    name: "depth"
                }, {
                    label: "Heat production:",
                    name: "heat_production"
                }, {
                    label: "Uncertainty:",
                    name: "uncertainty",
                }, {
                    label: "Method:",
                    name: "method"
                }
            ]
      });


    $('#{{id}}-table').DataTable( {
        columnDefs: [{targets: [0], render: $.fn.dataTable.render.href()}],
        keys: {
            editor:  {{editor}}
        },
        select: {
            style:    'os',
            selector: 'td:first-child',
            blurable: true
        },
        buttons: [
            { extend: "create", editor: {{editor}} },
            { extend: "edit",   editor: {{editor}} },
            { extend: "remove", editor: {{editor}} }
        ]
    });


    $('#{{id}}-table').on( 'click', 'tbody td:not(:first-child)', function (e) {
        {{editor}}.inline( this );
    } );

  });
</script>
{% endaddtoblock %}

<style>
div.DTE_Inline input {
      border: none;
      background-color: transparent;
      padding: 0 !important;
      font-size: 90%;
  }
 
div.DTE_Inline input:focus {
    outline: none;
    background-color: transparent;
}

</style>
{% endwith %} {% endcomment %}