{% load static meta cms_tags menu_tags sekizai_tags authentication thumbnail geoluminate simple_menu i18n %}
{% if not request.htmx %}
  {% generate_menu %}
  <!doctype html>
  <html lang="en">
    <head {% meta_namespaces %}>
      <meta charset="utf-8" />
      <meta name="viewport"
            content="width=device-width, initial-scale=1, user-scalable=no"/>
      <title>
        {% block head_title %}
        {% endblock head_title %}
      | {{ config.site.name }}</title>
      {% include 'meta/meta.html' %}
      {% block head %}
      {% endblock head %}
      <link rel="icon" type="image/svg+xml" href="{% icon %}">
      <link rel="stylesheet" href="{% static "theme/css/theme.min.css" %}">
      <script src="https://unpkg.com/htmx.org@1.8.0"
              integrity="sha384-cZuAZ+ZbwkNRnrKi05G/fjBX+azI9DNOkNYysZ0I/X5ZFgsmMiBXgDZof30F5ofc"
              crossorigin="anonymous"></script>
      <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
      <link href="{% static 'tellme/vendor/feedback/feedback.css' %}"
            rel="stylesheet">
    {% endif %}
    {% render_block "css" %}
    {% if not request.htmx %}
    </head>
    <body class='bg-white'
          hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
          hx-indicator="#mainIndicator">
      <div class='page-wrapper overflow-hidden'>
        {% if request.user|has_group:"CMS" or request.user.is_superuser %}
          {% include 'geoluminate/utils/cms_toolbar.html' %}
        {% endif %}
      {% endif %}
      {% block wrapper %}
        {% if not request.htmx %}
          <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container-fluid">
              <button class="navbar-toggler"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#navbarSupportedContent"
                      aria-controls="navbarSupportedContent"
                      aria-expanded="false"
                      aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse " id="navbarSupportedContent">
                {% comment %} <ul class="navbar-nav mb-2 mb-lg-0"> {% endcomment %}
                <ul class="navbar-nav w-100">
                  {% show_menu 0 100 100 100 "theme/menu/nav_menu.html" %}
                  <div class='d-inline-flex ms-auto'>
                    {% include 'ror/geoluminate_menu.html' %}
                    {% include 'authentication/navbar_widget.html' %}
                  </div>
                </ul>
              </div>
            </div>
          </nav>
          <div class='page-inner position-relative overflow-x-hidden overflow-y-auto'>
            {% include 'theme/navigation/sidebar.html' %}
            <div id='outer' class='d-flex flex-column flex-grow-1' hx-target="#main">
              <div id='appmenu' class="container">
              {% endif %}
              {% block app_menu %}
              {% endblock app_menu %}
              {% if not request.htmx %}
              </div>
              {% include "geoluminate/components/messages.html" %}
              <div id="main">
              {% endif %}
              {% block content %}
              {% endblock content %}
              <img id='mainIndicator'
                   class="htmx-indicator"
                   src="{% static "geoluminate/img/spinners/spinning-circles.svg" %}"/>
            </div>
          </div>
          {% block sidebar_right %}
          {% endblock sidebar_right %}
        </div>
      {% endblock wrapper %}
      {% include "authentication/login_or_register.html" %}
      {% block modals %}
      {% endblock modals %}
      {% render_block "modals" %}
      <script>const config = {{ config_json | safe}};</script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
              integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
              crossorigin="anonymous"
              referrerpolicy="no-referrer"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
              integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
              crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
              integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
              crossorigin="anonymous"></script>
      <script src="https://kit.fontawesome.com/a08181010c.js"></script>
      {% include 'tellme/js_inc.html' %}
      <script src="{% static "geoluminate/js/custom.js" %}"></script>
      {% render_block "js" %}
      {% block scripts %}
      {% endblock scripts %}
      <button type="button"
              id="feedback-btn"
              class="btn vertical-right-aligned"
              data-bs-toggle="modal"
              data-bs-target="#feedback-welcome">
        {% trans 'Feedback' %} <span class="fas fa-bullhorn" aria-hidden="true"></span>
      </button>
      {% include 'geoluminate/utils/screen-size-indicator.html' %}
    </div>
  </body>
</html>
