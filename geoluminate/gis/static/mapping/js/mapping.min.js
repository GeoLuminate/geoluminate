var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},defaults={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",fadeColor:"transparent",animation:"spinner-line-fade-default",rotate:0,direction:1,speed:1,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:"0 0 1px transparent",position:"absolute"},Spinner=function(){function e(e){void 0===e&&(e={}),this.opts=__assign({},defaults,e)}return e.prototype.spin=function(e){return this.stop(),this.el=document.createElement("div"),this.el.className=this.opts.className,this.el.setAttribute("role","progressbar"),css(this.el,{position:this.opts.position,width:0,zIndex:this.opts.zIndex,left:this.opts.left,top:this.opts.top,transform:"scale("+this.opts.scale+")"}),e&&e.insertBefore(this.el,e.firstChild||null),drawLines(this.el,this.opts),this},e.prototype.stop=function(){return this.el&&("undefined"!=typeof requestAnimationFrame?cancelAnimationFrame(this.animateId):clearTimeout(this.animateId),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=void 0),this},e}();function css(e,t){for(var a in t)e.style[a]=t[a];return e}function getColor(e,t){return"string"==typeof e?e:e[t%e.length]}function drawLines(e,t){var a=Math.round(t.corners*t.width*500)/1e3+"px",n="none";!0===t.shadow?n="0 2px 4px #000":"string"==typeof t.shadow&&(n=t.shadow);for(var r=parseBoxShadow(n),o=0;o<t.lines;o++){var i=~~(360/t.lines*o+t.rotate),s=css(document.createElement("div"),{position:"absolute",top:-t.width/2+"px",width:t.length+t.width+"px",height:t.width+"px",background:getColor(t.fadeColor,o),borderRadius:a,transformOrigin:"left",transform:"rotate("+i+"deg) translateX("+t.radius+"px)"}),d=o*t.direction/t.lines/t.speed;d-=1/t.speed;var l=css(document.createElement("div"),{width:"100%",height:"100%",background:getColor(t.color,o),borderRadius:a,boxShadow:normalizeShadow(r,i),animation:1/t.speed+"s linear "+d+"s infinite "+t.animation});s.appendChild(l),e.appendChild(s)}}function parseBoxShadow(e){for(var t=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,a=[],n=0,r=e.split(",");n<r.length;n++){var o=r[n].match(t);if(null!==o){var i=+o[2],s=+o[5],d=o[4],l=o[7];0!==i||d||(d=l),0!==s||l||(l=d),d===l&&a.push({prefix:o[1]||"",x:i,y:s,xUnits:d,yUnits:l,end:o[8]})}}return a}function normalizeShadow(e,t){for(var a=[],n=0,r=e;n<r.length;n++){var o=r[n],i=convertOffset(o.x,o.y,t);a.push(o.prefix+i[0]+o.xUnits+" "+i[1]+o.yUnits+o.end)}return a.join(", ")}function convertOffset(e,t,a){var n=a*Math.PI/180,r=Math.sin(n),o=Math.cos(n);return[Math.round(1e3*(e*o+t*r))/1e3,Math.round(1e3*(-e*r+t*o))/1e3]}!function(e,t){"function"==typeof define&&define.amd?define(["leaflet"],function(t){e(t)}):"object"==typeof exports?module.exports=function(t){return void 0===t&&(t=require("leaflet")),e(t),t}:void 0!==t&&t.L&&e(t.L)}(function(e){var t={spin:function(e,t){e?(this._spinner||(this._spinner=new Spinner(t).spin(this._container),this._spinning=0),this._spinning++):(this._spinning--,this._spinning<=0&&this._spinner&&(this._spinner.stop(),this._spinner=null))}};e.Map.include(t),e.Map.addInitHook(function(){this.on("layeradd",function(e){e.layer.loading&&this.spin(!0),"function"==typeof e.layer.on&&(e.layer.on("data:loading",function(){this.spin(!0)},this),e.layer.on("data:loaded",function(){this.spin(!1)},this))},this),this.on("layerremove",function(e){e.layer.loading&&this.spin(!1),"function"==typeof e.layer.on&&(e.layer.off("data:loaded"),e.layer.off("data:loading"))},this)})},window);var map=createMap().fitWorld(),clusters=createClusters();function createMap(){var e={"Dark Gray":L.esri.basemapLayer("DarkGray",{detectRetina:!0}),Imagery:L.esri.basemapLayer("Imagery",{detectRetina:!0}),Oceans:L.esri.basemapLayer("Oceans",{detectRetina:!0}),Topographic:L.esri.basemapLayer("Topographic",{detectRetina:!0}),"Nat Geo":L.esri.basemapLayer("NationalGeographic",{detectRetina:!0})},t=L.map("map",{layers:[e.Imagery],minZoom:2,worldCopyJump:!0,fullscreenControl:!0});return L.control.scale().addTo(t),L.control.layers(e).addTo(t),t}function get_color(){return"#"+Math.floor(16777215*Math.random()).toString(16)}function add_to_map(e){get_color();var t=L.geoJson(e,{});if(e.features.length>250){var a=L.markerClusterGroup({disableClusteringAtZoom:8,spiderfyOnMaxZoom:!1});a.addLayer(t),a.addTo(map)}else t.addTo(map);return map.flyToBounds(t.getBounds(),{maxZoom:8}),t}function add_and_zoom(e){layer=add_to_map(e),map.flyToBounds(layer.getBounds(),{maxZoom:8})}function add_shape(e){layer=L.geoJson(e).addTo(map)}function createMarkers(e,t){var a=e.columns.indexOf("Latitude"),n=e.columns.indexOf("Longitude"),r=e.columns.indexOf(t),o=[];return e.data.forEach(e=>{var t=L.circleMarker([e[a],e[n]],{radius:3,fill:!0,fillOpacity:.75,fillColor:"rgb(255,0,0,1)",stroke:!1});t.value=e[r],o.push(t)}),L.featureGroup(o)}function createClusters(){return L.markerClusterGroup({chunkedLoading:!0,disableClusteringAtZoom:8,spiderfyOnMaxZoom:!1})}function updateData(){map.spin(!0),$.post({url:$(location).attr("href"),data:$("#filter-form").serializeArray(),success:updatePage,complete:stop_spin,error:stop_spin})}async function updatePage(e){await new updateTable(e),await new updateMap(e)}function stop_spin(){map.spin(!1)}function updateMap(e){e.columns.push(e.type),clusters.clearLayers(),markers=createMarkers(e,e.type),clusters.addLayers(markers,{chunkedLoading:!0}),e.data.length>0?map.flyToBounds(markers.getBounds()):map.fitWorld()}function updateTable(e){var t=e.columns.indexOf(e.type);e.id="#dataTable",$.fn.dataTable.isDataTable(e.id)?(table=$(e.id).DataTable(),table.clear()):table=table_from_values(e),table.rows.add(e.data),$(table.column(t).header()).html({heat_flow:"Heat Flow",temperature:"Temp. Count",conductivity:"Cond. Count",gradient:"Gradient",heat_generation:"Heat Gen. Count"}[e.type]),table.draw()}function customClusterIcon(e){e.getChildCount();var t=e.getAllChildMarkers(),a=0;t.forEach(e=>{a+=e.value});var n=Math.round(10*(a/t.length+Number.EPSILON))/10;return color=query_cbar(n,.6),html='<div style="background-color:'+color+'"><span>'+n+"</span>",new L.DivIcon({html:html,className:"marker-cluster",iconSize:new L.Point(40,40)})}function onEachFeature(e,t){var a=Object.entries(e.properties),n="<div class='h5'>"+a.shift()[1]+"</div>";n+="<table class='table table-striped'><tbody>",a.forEach(e=>{e[1]&&"slug"!=e[0]&&(n+="<tr><td >"+titleize(e[0])+":  </td><td>"+e[1]+"</td></td>")}),n+="</tbody></table>",t.bindPopup(n)}map.addLayer(clusters);