FROM geoluminate/geoluminate:latest AS run-stage

ENV PYTHONUNBUFFERED 1 \
    PYTHONDONTWRITEBYTECODE 1 \
    POETRY_VIRTUALENVS_CREATE=false \
    POETRY_VIRTUALENVS_IN_PROJECT=true \
    POETRY_NO_INTERACTION=1

RUN apt-get update && \
    pip install poetry && \
    poetry self add poetry-plugin-bundle && \
    apt-get install --no-install-suggests --no-install-recommends

COPY pyproject.toml poetry.lock ./
RUN poetry install --no-root --no-dev
# RUN poetry bundle venv --python=/usr/local/bin/python3 --only=main /venv
# RUN poetry bundle venv --only=main /venv

